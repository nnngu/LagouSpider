# ğŸ•·ï¸ çˆ¬å–æ‹‰å‹¾ç½‘èŒä½ä¿¡æ¯çš„çˆ¬è™«ï¼

## æ•ˆæœé¢„è§ˆ

![][7]

## æ€è·¯

1ã€é¦–å…ˆæˆ‘ä»¬æ‰“å¼€æ‹‰å‹¾ç½‘ï¼Œå¹¶æœç´¢â€œjavaâ€ï¼Œæ˜¾ç¤ºå‡ºæ¥çš„èŒä½ä¿¡æ¯å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚

2ã€æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®å®šï¼Œæ€æ ·å°†ä¿¡æ¯æå–å‡ºæ¥ã€‚

* æŸ¥çœ‹ç½‘é¡µæºä»£ç ï¼Œè¿™æ—¶å€™å‘ç°ï¼Œç½‘é¡µæºä»£ç é‡Œé¢æ‰¾ä¸åˆ°èŒä½ç›¸å…³ä¿¡æ¯ï¼Œè¿™è¯æ˜æ‹‰å‹¾ç½‘å…³äºèŒä½çš„ä¿¡æ¯æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¸¸ç”¨çš„æŠ€æœ¯ã€‚

* å¼‚æ­¥åŠ è½½çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© chrome æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·è¿›è¡Œåˆ†æï¼Œæ‰“å¼€å¼€å‘è€…å·¥å…·çš„æ–¹æ³•å¦‚ä¸‹ï¼š

![][1]

* ç‚¹å‡»Nerworkè¿›å…¥ç½‘ç»œåˆ†æç•Œé¢ï¼Œè¿™æ—¶å€™æ˜¯ä¸€ç‰‡ç©ºç™½ï¼Œåˆ·æ–°ä¸€ä¸‹ç•Œé¢å°±å¯ä»¥çœ‹åˆ°ä¸€ç³»åˆ—çš„ç½‘ç»œè¯·æ±‚äº†ã€‚

![][2]

* å‰é¢æˆ‘ä»¬è¯´åˆ°ï¼Œæ‹‰å‹¾ç½‘å…³äºèŒä½çš„ä¿¡æ¯æ˜¯å¼‚æ­¥åŠ è½½çš„ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸€ç³»åˆ—çš„ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå¿…å®šæœ‰æŸä¸ªè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ï¼Œå“åº”å›æ¥çš„æ˜¯èŒä½ä¿¡æ¯ã€‚

* æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥cssï¼Œå›¾ç‰‡ç­‰ç±»å‹çš„è¯·æ±‚ï¼Œå…³æ³¨ç‚¹æ”¾åœ¨XHRè¿™ç§ç±»å‹è¯·æ±‚ä¸Šï¼Œå¦‚å›¾ï¼š

![][3]

ä¸€å…±4ä¸ªXHRç±»å‹çš„è¯·æ±‚ï¼Œæˆ‘ä»¬é€ä¸ªæ‰“å¼€å¯¹æ¯”ï¼Œåˆ†åˆ«ç‚¹å‡»Previewå°±èƒ½çœ‹åˆ°å®ƒä»¬å“åº”çš„å†…å®¹ã€‚

å‘ç°ç¬¬ä¸€ä¸ªè¯·æ±‚å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ã€‚å¦‚å›¾ï¼š

![][4]

ç‚¹å‡»Headersï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¯·æ±‚å‚æ•°ã€‚å¦‚ä¸‹å›¾ï¼š

![][5]

åˆ°æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šcityå‚æ•°å°±æ˜¯åŸå¸‚ï¼Œpnå‚æ•°å°±æ˜¯é¡µæ•°ï¼Œkdå‚æ•°å°±æ˜¯æœç´¢å…³é”®å­—ã€‚

æ¥ä¸‹æ¥å¼€å§‹å†™ä»£ç äº†ã€‚

## ä»£ç 

ä»£ç åˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼Œä¾¿äºåæœŸç»´æŠ¤ã€‚

**1ã€åŸºæœ¬ https è¯·æ±‚`https.py`**

è¿™éƒ¨åˆ†å¯¹ requests åŒ…è¿›è¡Œäº†ä¸€äº›å°è£…ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š

```python
# -*- coding: utf-8 -*-
from src.setting import IP, UA
import requests, random
import logging


class Http:
    '''
    httpè¯·æ±‚ç›¸å…³çš„æ“ä½œ
    '''

    def __init__(self):
        pass

    def get(self, url, headers=None, cookies=None, proxy=None, timeOut=5, timeOutRetry=5):
        '''
        è·å–ç½‘é¡µæºç 
        url: ç½‘é¡µé“¾æ¥
        headers: headers
        cookies: cookies
        proxy: ä»£ç†
        timeOut: è¯·æ±‚è¶…æ—¶æ—¶é—´
        timeOutRetry: è¶…æ—¶é‡è¯•æ¬¡æ•°
        return: æºç 
        '''
        if not url:
            logging.error('GetError url not exit')
            return 'None'

		# è¿™é‡Œåªå±•ç¤ºäº†ä¸€éƒ¨åˆ†ä»£ç 
		# å®Œæ•´ä»£ç å·²ä¸Šä¼ åˆ°Github
```

è¿™é‡Œåªå±•ç¤ºäº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œå®Œæ•´ä»£ç å·²ä¸Šä¼ åˆ°[Github](https://github.com/nnngu/LagouSpider)

**2ã€ä»£ç ä¸»é€»è¾‘éƒ¨åˆ†`main.py`**

è¿™éƒ¨åˆ†çš„ç¨‹åºé€»è¾‘ï¼Œå¦‚ä¸‹ï¼š

* è·å–èŒä½ä¿¡æ¯

```python
def getInfo(url, para):
    """
    è·å–ä¿¡æ¯
    """
    generalHttp = Http()
    htmlCode = generalHttp.post(url, para=para, headers=headers, cookies=cookies)
    generalParse = Parse(htmlCode)
    pageCount = generalParse.parsePage()
    info = []
    for i in range(1, 3):
        print('ç¬¬%sé¡µ' % i)
        para['pn'] = str(i)
        htmlCode = generalHttp.post(url, para=para, headers=headers, cookies=cookies)
        generalParse = Parse(htmlCode)
        info = info + getInfoDetail(generalParse)
        time.sleep(2)
    return info
```

* å¯¹ä¿¡æ¯è¿›è¡Œå‚¨å­˜

```python
def processInfo(info, para):
    """
    ä¿¡æ¯å­˜å‚¨
    """
    logging.error('Process start')
    try:
        title = 'å…¬å¸åç§°\tå…¬å¸ç±»å‹\tèèµ„é˜¶æ®µ\tæ ‡ç­¾\tå…¬å¸è§„æ¨¡\tå…¬å¸æ‰€åœ¨åœ°\tèŒä½ç±»å‹\tå­¦å†è¦æ±‚\tç¦åˆ©\tè–ªèµ„\tå·¥ä½œç»éªŒ\n'
        file = codecs.open('%sèŒä½.xls' % para['city'], 'w', 'utf-8')
        file.write(title)
        for p in info:
            line = str(p['companyName']) + '\t' + str(p['companyType']) + '\t' + str(p['companyStage']) + '\t' + \
                   str(p['companyLabel']) + '\t' + str(p['companySize']) + '\t' + str(p['companyDistrict']) + '\t' + \
                   str(p['positionType']) + '\t' + str(p['positionEducation']) + '\t' + str(
                p['positionAdvantage']) + '\t' + \
                   str(p['positionSalary']) + '\t' + str(p['positionWorkYear']) + '\n'
            file.write(line)
        file.close()
        return True
    except Exception as e:
        print(e)
        return None
```

**3ã€ä¿¡æ¯è§£æéƒ¨åˆ†`parse.py`**

è¿™éƒ¨åˆ†é’ˆå¯¹æœåŠ¡å™¨è¿”å›çš„èŒä½ä¿¡æ¯çš„ç‰¹ç‚¹ï¼Œè¿›è¡Œè§£æï¼Œå¦‚ä¸‹ï¼š

```python
class Parse:
    '''
    è§£æç½‘é¡µä¿¡æ¯
    '''

    def __init__(self, htmlCode):
        self.htmlCode = htmlCode
        self.json = demjson.decode(htmlCode)
        pass

    def parseTool(self, content):
        '''
        æ¸…é™¤htmlæ ‡ç­¾
        '''
        if type(content) != str: return content
        sublist = ['<p.*?>', '</p.*?>', '<b.*?>', '</b.*?>', '<div.*?>', '</div.*?>',
                   '</br>', '<br />', '<ul>', '</ul>', '<li>', '</li>', '<strong>',
                   '</strong>', '<table.*?>', '<tr.*?>', '</tr>', '<td.*?>', '</td>',
                   '\r', '\n', '&.*?;', '&', '#.*?;', '<em>', '</em>']
        try:
            for substring in [re.compile(string, re.S) for string in sublist]:
                content = re.sub(substring, "", content).strip()
        except:
            raise Exception('Error ' + str(substring.pattern))
        return content

		# è¿™é‡Œåªå±•ç¤ºäº†ä¸€éƒ¨åˆ†ä»£ç 
		# å®Œæ•´ä»£ç å·²ä¸Šä¼ åˆ°Github
```

è¿™é‡Œåªå±•ç¤ºäº†ä¸€éƒ¨åˆ†ä»£ç ï¼Œå®Œæ•´ä»£ç å·²ä¸Šä¼ åˆ°[Github](https://github.com/nnngu/LagouSpider)

**4ã€é…ç½®éƒ¨åˆ†`setting.py`**

è¿™éƒ¨åˆ†åŠ å…¥ cookies çš„åŸå› æ˜¯ä¸ºäº†åº”å¯¹æ‹‰å‹¾ç½‘çš„åçˆ¬ï¼Œé•¿æœŸä½¿ç”¨éœ€è¦è¿›è¡Œæ”¹è¿›ï¼Œè¿›è¡ŒåŠ¨æ€ cookies è·å–

```python
# -*- coding: utf-8 -*-

# headers
headers = {
    'Host': 'www.lagou.com',
    'Connection': 'keep-alive',
    'Content-Length': '23',
    'Origin': 'https://www.lagou.com',
    'X-Anit-Forge-Code': '0',
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36',
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
    'Accept': 'application/json, text/javascript, */*; q=0.01',
    'X-Requested-With': 'XMLHttpRequest',
    'X-Anit-Forge-Token': 'None',
    'Referer': 'https://www.lagou.com/jobs/list_java?city=%E5%B9%BF%E5%B7%9E&cl=false&fromSearch=true&labelWords=&suginput=',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7'
}
```

## æµ‹è¯•

è¿è¡Œç»“æœï¼š

![][6]

çˆ¬å–ç»“æŸåï¼Œåœ¨srcç›®å½•ä¸‹å°±å¯ä»¥çœ‹åˆ°çˆ¬è™«çˆ¬å–åˆ°çš„æ•°æ®ã€‚

![][7]

åˆ°æ­¤ï¼Œæ‹‰å‹¾ç½‘çš„èŒä½ä¿¡æ¯æŠ“å–å°±å®Œæˆäº†ã€‚å®Œæ•´ä»£ç å·²ç»ä¸Šä¼ åˆ°[æˆ‘çš„Github](https://github.com/nnngu/LagouSpider)


  [1]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517604536071.jpg
  [2]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517604631241.jpg
  [3]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517605038140.jpg
  [4]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517605245280.jpg
  [5]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517605796162.jpg
  [6]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517607653279.jpg
  [7]: https://www.github.com/nnngu/FigureBed/raw/master/2018/2/3/1517607553153.jpg